<!DOCTYPE HTML>
<html lang="en">
<head>
  <title>Share cell</title>
  <link rel="stylesheet" href="thebe.css" type="text/css"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://rawgit.com/oreillymedia/thebe/master/static/main-built.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
  <pre data-executable='true' id='singlecell'>
%matplotlib inline
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

from IPython.html.widgets import interact

@interact
def explore(n=10):
    x = np.linspace(0, n, 1000)
    plt.plot(x, np.sin(x), x, np.cos(x));
    sns.set()
    plt.plot(x, np.sin(x), x, np.cos(x));
	</pre>

  <div class="thebe_controls" style="display:block; width:600px; margin-left:auto; margin-right:auto;">
    <button class="thebe_controls" data-action="share" id="share" style="display:block;">Share</button>
  </div>

	<script>
  /**
   * Returns a bare object of the URL's query parameters.
   * You can pass just a query string rather than a complete URL.
   * The default URL is the current page.
   *
   * From: http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
   */
  function getUrlParams (url) {
      // http://stackoverflow.com/a/23946023/2407309
      if (typeof url == 'undefined') {
          url = window.location.search
      }
      var url = url.split('#')[0] // Discard fragment identifier.
      var queryString = url.split('?')[1]
      if (!queryString) {
          if (url.search('=') !== false) {
              queryString = url
          }
      }
      var urlParams = {}
      if (queryString) {
          var keyValuePairs = queryString.split('&')
          for (var i = 0; i < keyValuePairs.length; i++) {
              var keyValuePair = keyValuePairs[i].split('=')
              var paramName = keyValuePair[0]
              var paramValue = keyValuePair[1] || ''
              urlParams[paramName] = decodeURIComponent(paramValue.replace(/\+/g, ' '))
          }
      }
      return urlParams
  } // getUrlParams

  // Check Location
	if ( document.location.protocol === 'file:' ) {
		alert("The HTML5 History API doesn't work on files, please use a local server. I'd recommend node's http-server.");
  }

  $( document ).ready(function(){

    params = getUrlParams();

    // Inject code on the page
    var code = params.code || $('#singlecell').text();
    var kernel_name = params.kernel_name || 'python3';
    // Change the code before thebe gets its hand on the `<pre>` block
    if (code) {
      $('#singlecell').text(code);
    }

    thebe = new Thebe({
      url:"https://tmp23.tmpnb.org",
      kernel_name: kernel_name
    });

    var createState = function() {
      return {
        kernel_name: thebe.options.kernel_name,
        code: thebe.cells[0].get_text()
      }
    }

    history.replaceState(createState(), document.title, document.location.href);

    $('#share').click(function(e) {
      var state = createState();

      var newLoc = "?code=" + encodeURIComponent(state.code);
      newLoc = newLoc + "&kernel_name=" + state.kernel_name;

      history.pushState(state, null, newLoc)

    });

    window.onpopstate = function(event) {
      // Bring the old code back
      thebe.cells[0].set_text(event.state.code);
      // TODO: Bring back the kernel
    }

	});
	</script>
</body>
</html>
